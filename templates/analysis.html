{% extends "base.html" %} {% block title %}Análise de Dados{% endblock %} {%
block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <h1 class="mb-4">
        <i class="fas fa-chart-area me-3"></i>
        Análise Automática dos Dados
      </h1>
      <p class="text-muted">
        Visualizações geradas automaticamente pelo Python com base no seu
        dataset CSV.
      </p>
    </div>
  </div>

  {% if filename and stats %}
  <!-- Dataset Information -->
  <div class="row mb-4">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-file-csv me-2"></i>
            Informações do Dataset
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <p>
                <strong>Arquivo:</strong><br /><span class="text-muted"
                  >{{ filename }}</span
                >
              </p>
            </div>
            <div class="col-md-4">
              <p>
                <strong>Dimensões:</strong><br /><span class="badge bg-primary"
                  >{{ shape[0] }} linhas × {{ shape[1] }} colunas</span
                >
              </p>
            </div>
            <div class="col-md-4">
              <p>
                <strong>Gráficos:</strong><br /><span class="badge bg-success"
                  >{{ plots|length if plots else 0 }} visualizações</span
                >
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <i class="fas fa-database fa-3x mb-3"></i>
          <h3>{{ shape[0] }}</h3>
          <p class="mb-0">Registros Analisados</p>
        </div>
      </div>
    </div>
  </div>

  {% if plots %}
  <div class="row mb-2">
    <div class="col-12">
      <div class="alert alert-info">
        <strong>Debug:</strong> {{ plots|length }} plots encontrados: {{
        plots.keys()|list }}
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-images me-2"></i>
            Gráficos Gerados Automaticamente
          </h5>
        </div>
        <div class="card-body">
          <!-- Histogramas de Distribuição -->
          <h6 class="mb-3 text-primary">
            <i class="fas fa-chart-bar me-2"></i>
            Distribuições das Variáveis Numéricas
          </h6>
          <div class="row mb-4">
            {% for plot_key, plot_url in plots.items() %} {% if plot_key !=
            'correlation' and plot_key != 'mapa_vendas' and
            plot_url.endswith('.png') %}
            <div class="col-md-6 col-lg-4 mb-3">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">Distribuição: {{ plot_key.title() }}</h6>
                </div>
                <div class="card-body text-center">
                  <img
                    src="{{ plot_url }}"
                    class="img-fluid"
                    alt="Distribuição de {{ plot_key }}"
                    style="max-height: 250px"
                  />
                  <div class="mt-2">
                    <a
                      href="{{ plot_url }}"
                      target="_blank"
                      class="btn btn-sm btn-outline-primary"
                    >
                      <i class="fas fa-download me-1"></i>Download
                    </a>
                  </div>
                </div>
              </div>
            </div>
            {% endif %} {% endfor %}
          </div>

          <!-- Matriz de Correlação -->
          {% if plots.correlation %}
          <h6 class="mb-3 text-success">
            <i class="fas fa-project-diagram me-2"></i>
            Matriz de Correlação
          </h6>
          <div class="row mb-4">
            <div class="col-md-8 offset-md-2">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">Correlação entre Variáveis Numéricas</h6>
                </div>
                <div class="card-body text-center">
                  <img
                    src="{{ plots.correlation }}"
                    class="img-fluid"
                    alt="Matriz de Correlação"
                    style="max-height: 500px"
                  />
                  <p class="mt-2 text-muted small">
                    Correlação entre as variáveis numéricas do dataset
                  </p>
                  <div class="mt-2">
                    <a
                      href="{{ plots.correlation }}"
                      target="_blank"
                      class="btn btn-sm btn-outline-success"
                    >
                      <i class="fas fa-download me-1"></i>Download
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Mapa Interativo (se disponível) -->
          {% if plots.mapa_vendas %}
          <h6 class="mb-3 text-warning">
            <i class="fas fa-map-marked-alt me-2"></i>
            Mapa Interativo das Cidades
          </h6>
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">Distribuição Geográfica dos Dados</h6>
                </div>
                <div class="card-body">
                  <iframe
                    src="{{ plots.mapa_vendas }}"
                    width="100%"
                    height="400"
                    frameborder="0"
                  >
                  </iframe>
                  <div class="mt-2">
                    <a
                      href="{{ plots.mapa_vendas }}"
                      target="_blank"
                      class="btn btn-sm btn-outline-warning"
                    >
                      <i class="fas fa-external-link-alt me-1"></i>Abrir em Nova
                      Aba
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Action Buttons -->
  <div class="row mb-4">
    <div class="col-12 text-center">
      <a href="{{ url_for('upload_page') }}" class="btn btn-primary me-2">
        <i class="fas fa-upload me-2"></i>Novo Dataset
      </a>
      <a href="{{ url_for('prediction_page') }}" class="btn btn-warning me-2">
        <i class="fas fa-brain me-2"></i>Treinar Modelo ML
      </a>
      <a href="{{ url_for('dashboard') }}" class="btn btn-info">
        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
      </a>
    </div>
  </div>

  {% else %}
  <!-- No Analysis Content -->
  <div class="row">
    <div class="col-md-6 offset-md-3">
      <div class="card text-center">
        <div class="card-body py-5">
          <i class="fas fa-chart-bar fa-5x text-muted mb-4"></i>
          <h4 class="text-muted">Nenhuma Análise Disponível</h4>
          <p class="text-muted">
            Faça o upload de um arquivo CSV para gerar visualizações automáticas
            dos seus dados.
          </p>
          <div class="mb-3">
            <small class="text-muted">
              <strong>Gráficos que serão gerados:</strong><br />
              • Histogramas de distribuição (variáveis numéricas)<br />
              • Matriz de correlação<br />
              • Mapa interativo (se houver cidades)
            </small>
          </div>
          <a href="{{ url_for('upload_page') }}" class="btn btn-primary">
            <i class="fas fa-upload me-2"></i>Fazer Upload
          </a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %} {% block scripts %} {% endblock %}
